{{- $authors := .Site.Data.authors -}}
{{- $authorId := .authorId | default .Site.Params.author.id -}}
{{- $scratch := newScratch -}}
{{- $scratch.Set "author" nil -}}

{{- if and $authorId $authors -}}
  {{- with index $authors $authorId -}}
    {{- $scratch.Set "author" . -}}
  {{- end -}}
{{- end -}}

{{- if and (not ($scratch.Get "author")) $authors -}}
  {{- range $id, $data := $authors -}}
    {{- if or (not $authorId) (not ($scratch.Get "author")) }}{{- $scratch.Set "author" $data -}}{{- end -}}
  {{- end -}}
{{- end -}}

{{- $author := $scratch.Get "author" -}}

{{- if $author -}}
<div class="author-bio" itemscope itemtype="https://schema.org/Person">
  <div class="author-bio-header">
    {{- with $author.avatar -}}
    <img
      src="{{ . }}"
      alt="{{ $author.avatarAlt | default (printf "%s profile photo" ($author.fullName | default $author.name)) }}"
      class="author-avatar"
      itemprop="image"
      width="80"
      height="80"
      loading="lazy"
    />
    {{- end -}}

    <div class="author-bio-info">
      <h4 class="author-name" itemprop="name">{{ $author.fullName | default $author.name }}</h4>

      {{- if or $author.role $author.company -}}
      <p class="author-position">
        {{- with $author.role -}}
          <span itemprop="jobTitle">{{ . }}</span>
        {{- end -}}
        {{- if and $author.role $author.company -}}
          <span> @ </span>
        {{- end -}}
        {{- with $author.company -}}
          <span itemprop="worksFor">{{ . }}</span>
        {{- end -}}
      </p>
      {{- end -}}

      {{- with $author.location -}}
      <p class="author-location">
        <i data-feather="map-pin" aria-hidden="true"></i>
        <span itemprop="address">{{ . }}</span>
      </p>
      {{- end -}}
    </div>
  </div>

  {{- with $author.bio -}}
  <p class="author-bio-text" itemprop="description">{{ . }}</p>
  {{- end -}}

  {{- if or $author.twitter $author.github $author.linkedin $author.website -}}
  <div class="author-social-links">
    {{- with $author.twitter -}}
    <a
      href="https://twitter.com/{{ . }}"
      target="_blank"
      rel="noopener noreferrer me"
      class="author-social-link"
      aria-label="Twitter profile"
      itemprop="sameAs"
    >
      <i data-feather="twitter" aria-hidden="true"></i>
      <span>Twitter</span>
    </a>
    {{- end -}}

    {{- with $author.github -}}
    <a
      href="https://github.com/{{ . }}"
      target="_blank"
      rel="noopener noreferrer me"
      class="author-social-link"
      aria-label="GitHub profile"
      itemprop="sameAs"
    >
      <i data-feather="github" aria-hidden="true"></i>
      <span>GitHub</span>
    </a>
    {{- end -}}

    {{- with $author.linkedin -}}
    <a
      href="https://www.linkedin.com/in/{{ . }}"
      target="_blank"
      rel="noopener noreferrer me"
      class="author-social-link"
      aria-label="LinkedIn profile"
      itemprop="sameAs"
    >
      <i data-feather="linkedin" aria-hidden="true"></i>
      <span>LinkedIn</span>
    </a>
    {{- end -}}

    {{- with $author.website -}}
    <a
      href="{{ . }}"
      target="_blank"
      rel="noopener noreferrer me"
      class="author-social-link"
      aria-label="Website"
      itemprop="url"
    >
      <i data-feather="globe" aria-hidden="true"></i>
      <span>Website</span>
    </a>
    {{- end -}}
  </div>
  {{- end -}}

  {{- with $author.expertise -}}
  <div class="author-expertise">
    <h5>{{ default "Expertise" $author.expertise_title }}</h5>
    <ul class="expertise-tags">
      {{- range . -}}
      <li><span class="expertise-tag">{{ . }}</span></li>
      {{- end -}}
    </ul>
  </div>
  {{- end -}}

  <meta itemprop="name" content="{{ $author.fullName | default $author.name }}" />
</div>
{{- end -}}
