<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<script>
	// Early theme init: avoid FOUC by setting dark class before CSS
	(function(){
	  try {
	    var mode = {{ printf "%q" .Site.Params.mode }} || "auto";
	    var ls = null;
	    try { ls = localStorage.getItem('theme'); } catch(e) {}
	    var prefersDark = false;
	    try { prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; } catch(e) {}
	    var useDark = (ls === 'dark') || (!ls && (mode === 'dark' || (mode === 'auto' && prefersDark)));
	    if (useDark) document.documentElement.classList.add('dark');
	  } catch(e) {}
	})();
	</script>

	{{- /* Security Headers and CSP */ -}}
	{{- partial "security-headers.html" . -}}
	{{- $title := ( .Title ) -}}
	{{- $siteTitle := ( .Site.Title ) -}}
	{{- if .IsHome -}}
	<title>{{ $siteTitle }} {{ if isset .Site.Params "subtitle" }}- {{ .Site.Params.Subtitle }}{{ end }} </title>
	{{- else -}}
	<title>{{ $title }} - {{ $siteTitle }}</title>
	{{- end -}}

	{{- /* Modern Favicon Implementation */ -}}
	{{- if isset .Site.Params "favicon" -}}
		<link rel="icon" type="image/x-icon" href="/{{ .Site.Params.favicon }}">
		<link rel="shortcut icon" type="image/x-icon" href="/{{ .Site.Params.favicon }}">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="manifest" href="/site.webmanifest">
		<meta name="theme-color" content="#007acc">
		<meta name="msapplication-TileColor" content="#007acc">
		<meta name="msapplication-config" content="/browserconfig.xml">
	{{- else -}}
		<link rel="icon" type="image/x-icon" href="/favicon.ico">
		<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
	{{- end -}}

	<meta name="viewport" content="width=device-width, initial-scale=1">
	{{ with .OutputFormats.Get "rss" -}}
	{{ printf `
	<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
	{{ end -}}

	{{- template "_internal/schema.html" . -}}
	{{- template "_internal/opengraph.html" . -}}
	{{- template "_internal/twitter_cards.html" . -}}
	{{- /* Hugo Pipes CSS with SRI */ -}}
	{{- $normalize := resources.Get "css/normalize.css" -}}
	{{- $main := resources.Get "css/main.css" -}}
	{{- $markdown := resources.Get "css/github-markdown.css" -}}
	{{- $codeblocks := resources.Get "css/github-codeblocks.css" -}}

	{{- /* Bundle core CSS */ -}}
	{{- $coreCSS := slice $normalize $main $markdown $codeblocks -}}
	{{- $bundledCSS := $coreCSS | resources.Concat "css/bundle.css" | resources.Minify | resources.Fingerprint -}}

	<link rel="stylesheet" href="{{ $bundledCSS.RelPermalink }}" integrity="{{ $bundledCSS.Data.Integrity }}" media="screen">

	{{- /* Tags & taxonomy specific CSS */ -}}
	{{- if or (eq .Kind "taxonomy") (eq .Kind "term") -}}
		{{- $tagsCSS := resources.Get "css/tags.css" -}}
		{{- if $tagsCSS -}}
			{{- $tagsCSSProcessed := $tagsCSS | resources.Minify | resources.Fingerprint -}}
			<link rel="stylesheet" href="{{ $tagsCSSProcessed.RelPermalink }}" integrity="{{ $tagsCSSProcessed.Data.Integrity }}">
		{{- end -}}
	{{- end -}}

	{{- /* Custom CSS if defined */ -}}
	{{- if isset .Site.Params "customcss" -}}
		{{- range .Site.Params.customCSS -}}
			{{- $customCSS := resources.Get . -}}
			{{- if $customCSS -}}
				{{- $customCSSProcessed := $customCSS | resources.Minify | resources.Fingerprint -}}
				<link rel="stylesheet" href="{{ $customCSSProcessed.RelPermalink }}" integrity="{{ $customCSSProcessed.Data.Integrity }}">
			{{- end -}}
		{{- end -}}
	{{- end -}}

	{{- /* Dark mode CSS */ -}}
	{{- $darkCSS := resources.Get "css/dark.css" -}}
	{{- if $darkCSS -}}
		{{- $darkCSSProcessed := $darkCSS | resources.Minify | resources.Fingerprint -}}
		<link id="dark-scheme" rel="stylesheet" href="{{ $darkCSSProcessed.RelPermalink }}" integrity="{{ $darkCSSProcessed.Data.Integrity }}">
	{{- end -}}

	{{- /* Custom dark CSS if defined */ -}}
	{{- if isset .Site.Params "customdarkcss" -}}
		{{- range .Site.Params.customDarkCSS -}}
			{{- $customDarkCSS := resources.Get . -}}
			{{- if $customDarkCSS -}}
				{{- $customDarkCSSProcessed := $customDarkCSS | resources.Minify | resources.Fingerprint -}}
				<link id="dark-scheme" rel="stylesheet" href="{{ $customDarkCSSProcessed.RelPermalink }}" integrity="{{ $customDarkCSSProcessed.Data.Integrity }}">
			{{- end -}}
		{{- end -}}
	{{- end -}}

	{{- /* Search CSS if enabled */ -}}
	{{- if .Site.Params.enablePagefind -}}
		{{- $searchCSS := resources.Get "css/search.css" -}}
		{{- if $searchCSS -}}
			{{- $searchCSSProcessed := $searchCSS | resources.Minify | resources.Fingerprint -}}
			<link rel="stylesheet" href="{{ $searchCSSProcessed.RelPermalink }}" integrity="{{ $searchCSSProcessed.Data.Integrity }}">
		{{- end -}}
	{{- end -}}

	{{- /* Topic Hub CSS for topic pages */ -}}
	{{- if eq .Layout "topic-hub" -}}
		{{- $topicCSS := resources.Get "css/topic-hub.css" -}}
		{{- if $topicCSS -}}
			{{- $topicCSSProcessed := $topicCSS | resources.Minify | resources.Fingerprint -}}
			<link rel="stylesheet" href="{{ $topicCSSProcessed.RelPermalink }}" integrity="{{ $topicCSSProcessed.Data.Integrity }}">
		{{- end -}}
	{{- end -}}

	{{- /* Series CSS for series pages */ -}}
	{{- if eq .Type "series" -}}
		{{- $seriesCSS := resources.Get "css/series.css" -}}
		{{- if $seriesCSS -}}
			{{- $seriesCSSProcessed := $seriesCSS | resources.Minify | resources.Fingerprint -}}
			<link rel="stylesheet" href="{{ $seriesCSSProcessed.RelPermalink }}" integrity="{{ $seriesCSSProcessed.Data.Integrity }}">
		{{- end -}}
	{{- end -}}

	{{- /* Accessibility CSS for all pages */ -}}
	{{- $accessibilityCSS := resources.Get "css/accessibility.css" -}}
	{{- if $accessibilityCSS -}}
		{{- $accessibilityCSSProcessed := $accessibilityCSS | resources.Minify | resources.Fingerprint -}}
		<link rel="stylesheet" href="{{ $accessibilityCSSProcessed.RelPermalink }}" integrity="{{ $accessibilityCSSProcessed.Data.Integrity }}">
	{{- end -}}

	{{- /* Author E-E-A-T CSS for about/author pages */ -}}
	{{- if or (eq .Type "about") (in .RelPermalink "/about") -}}
		{{- $authorEEATCSS := resources.Get "css/author-eeat.css" -}}
		{{- if $authorEEATCSS -}}
			{{- $authorEEATCSSProcessed := $authorEEATCSS | resources.Minify | resources.Fingerprint -}}
			<link rel="stylesheet" href="{{ $authorEEATCSSProcessed.RelPermalink }}" integrity="{{ $authorEEATCSSProcessed.Data.Integrity }}">
		{{- end -}}
	{{- end -}}

	{{- /* Aesthetic Refinements CSS for enhanced typography and design */ -}}
	{{- $aestheticCSS := resources.Get "css/aesthetic-refinements.css" -}}
	{{- if $aestheticCSS -}}
		{{- $aestheticCSSProcessed := $aestheticCSS | resources.Minify | resources.Fingerprint -}}
		<link rel="stylesheet" href="{{ $aestheticCSSProcessed.RelPermalink }}" integrity="{{ $aestheticCSSProcessed.Data.Integrity }}">
	{{- end -}}
	{{- $enableUmami := and (isset .Site.Params "enableumami") (.Site.Params.enableUmami) -}}
	{{- $hasURL := isset .Site.Params "umamiurl" -}}
	{{- $hasID := isset .Site.Params "umamiwebsiteid" -}}
	{{- if and $enableUmami $hasURL $hasID -}}
	<script defer src="{{ .Site.Params.umamiURL }}" data-website-id="{{ .Site.Params.umamiWebsiteId }}"
		data-tag="blog"></script>
	{{- end -}}
	{{- /* JavaScript assets with Hugo Pipes and SRI */ -}}
	{{ if and (isset .Site.Params "social") (isset .Site.Params "feathericonscdn") (eq .Site.Params.featherIconsCDN true) -}}
		{{- /* CDN version with SRI */ -}}
		<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"
		        integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE"
		        crossorigin="anonymous" defer></script>
	{{- else if (isset .Site.Params "social") -}}
		{{- /* Local feather icons */ -}}
		{{- $feather := resources.Get "js/feather.min.js" -}}
		{{- if $feather -}}
			{{- $featherProcessed := $feather | resources.Minify | resources.Fingerprint -}}
			<script src="{{ $featherProcessed.RelPermalink }}" integrity="{{ $featherProcessed.Data.Integrity }}" defer></script>
		{{- end -}}
	{{ end }}

	{{- /* Main theme JavaScript */ -}}
	{{- $mainJS := resources.Get "js/main.js" -}}
	{{- if $mainJS -}}
		{{- $mainJSProcessed := $mainJS | resources.Minify | resources.Fingerprint -}}
		<script src="{{ $mainJSProcessed.RelPermalink }}" integrity="{{ $mainJSProcessed.Data.Integrity }}" defer></script>
	{{- end -}}

	{{- /* Custom JavaScript if defined */ -}}
	{{- if isset .Site.Params "customjs" -}}
		{{- range .Site.Params.customJS -}}
			{{- $customJS := resources.Get . -}}
			{{- if $customJS -}}
				{{- $customJSProcessed := $customJS | resources.Minify | resources.Fingerprint -}}
				<script src="{{ $customJSProcessed.RelPermalink }}" integrity="{{ $customJSProcessed.Data.Integrity }}" defer></script>
			{{- end -}}
		{{- end -}}
	{{- end -}}
</head>
