<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	{{- $title := ( .Title ) -}}
	{{- $siteTitle := ( .Site.Title ) -}}
	{{- if .IsHome -}}
	<title>{{ $siteTitle }} {{ if isset .Site.Params "subtitle" }}- {{ .Site.Params.Subtitle }}{{ end }} </title>
	{{- else -}}
	<title>{{ $title }} - {{ $siteTitle }}</title>
	{{- end -}}

	{{- if isset .Site.Params "favicon" -}}
	<link rel="icon" type="image/png" href={{ .Site.Params.favicon }} />
	{{- end -}}

	<meta name="viewport" content="width=device-width, initial-scale=1">
	{{ with .OutputFormats.Get "rss" -}}
	{{ printf `
	<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
	{{ end -}}

	{{- template "_internal/schema.html" . -}}
	{{- template "_internal/opengraph.html" . -}}
	{{- template "_internal/twitter_cards.html" . -}}
	{{- /* Hugo Pipes CSS with SRI */ -}}
	{{- $normalize := resources.Get "css/normalize.css" -}}
	{{- $main := resources.Get "css/main.css" -}}
	{{- $markdown := resources.Get "css/github-markdown.css" -}}
	{{- $codeblocks := resources.Get "css/github-codeblocks.css" -}}

	{{- /* Bundle core CSS */ -}}
	{{- $coreCSS := slice $normalize $main $markdown $codeblocks -}}
	{{- $bundledCSS := $coreCSS | resources.Concat "css/bundle.css" | resources.Minify | resources.Fingerprint -}}

	<link rel="stylesheet" href="{{ $bundledCSS.RelPermalink }}" integrity="{{ $bundledCSS.Data.Integrity }}" media="screen">

	{{- /* Custom CSS if defined */ -}}
	{{- if isset .Site.Params "customcss" -}}
		{{- range .Site.Params.customCSS -}}
			{{- $customCSS := resources.Get . -}}
			{{- if $customCSS -}}
				{{- $customCSSProcessed := $customCSS | resources.Minify | resources.Fingerprint -}}
				<link rel="stylesheet" href="{{ $customCSSProcessed.RelPermalink }}" integrity="{{ $customCSSProcessed.Data.Integrity }}">
			{{- end -}}
		{{- end -}}
	{{- end -}}

	{{- /* Dark mode CSS */ -}}
	{{- $darkCSS := resources.Get "css/dark.css" -}}
	{{- if $darkCSS -}}
		{{- $darkCSSProcessed := $darkCSS | resources.Minify | resources.Fingerprint -}}
		<link id="dark-scheme" rel="stylesheet" href="{{ $darkCSSProcessed.RelPermalink }}" integrity="{{ $darkCSSProcessed.Data.Integrity }}">
	{{- end -}}

	{{- /* Custom dark CSS if defined */ -}}
	{{- if isset .Site.Params "customdarkcss" -}}
		{{- range .Site.Params.customDarkCSS -}}
			{{- $customDarkCSS := resources.Get . -}}
			{{- if $customDarkCSS -}}
				{{- $customDarkCSSProcessed := $customDarkCSS | resources.Minify | resources.Fingerprint -}}
				<link id="dark-scheme" rel="stylesheet" href="{{ $customDarkCSSProcessed.RelPermalink }}" integrity="{{ $customDarkCSSProcessed.Data.Integrity }}">
			{{- end -}}
		{{- end -}}
	{{- end -}}

	{{- /* Search CSS if enabled */ -}}
	{{- if .Site.Params.enablePagefind -}}
		{{- $searchCSS := resources.Get "css/search.css" -}}
		{{- if $searchCSS -}}
			{{- $searchCSSProcessed := $searchCSS | resources.Minify | resources.Fingerprint -}}
			<link rel="stylesheet" href="{{ $searchCSSProcessed.RelPermalink }}" integrity="{{ $searchCSSProcessed.Data.Integrity }}">
		{{- end -}}
	{{- end -}}
	{{- $enableUmami := and (isset .Site.Params "enableumami") (.Site.Params.enableUmami) -}}
	{{- $hasURL := isset .Site.Params "umamiurl" -}}
	{{- $hasID := isset .Site.Params "umamiwebsiteid" -}}
	{{- if and $enableUmami $hasURL $hasID -}}
	<script defer src="{{ .Site.Params.umamiURL }}" data-website-id="{{ .Site.Params.umamiWebsiteId }}"
		data-tag="blog"></script>
	{{- end -}}
	{{- /* JavaScript assets with Hugo Pipes and SRI */ -}}
	{{ if and (isset .Site.Params "social") (isset .Site.Params "feathericonscdn") (eq .Site.Params.featherIconsCDN true) -}}
		{{- /* CDN version with SRI */ -}}
		<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"
		        integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE"
		        crossorigin="anonymous" defer></script>
	{{- else if (isset .Site.Params "social") -}}
		{{- /* Local feather icons */ -}}
		{{- $feather := resources.Get "js/feather.min.js" -}}
		{{- if $feather -}}
			{{- $featherProcessed := $feather | resources.Minify | resources.Fingerprint -}}
			<script src="{{ $featherProcessed.RelPermalink }}" integrity="{{ $featherProcessed.Data.Integrity }}" defer></script>
		{{- end -}}
	{{ end }}

	{{- /* Main theme JavaScript */ -}}
	{{- $mainJS := resources.Get "js/main.js" -}}
	{{- if $mainJS -}}
		{{- $mainJSProcessed := $mainJS | resources.Minify | resources.Fingerprint -}}
		<script src="{{ $mainJSProcessed.RelPermalink }}" integrity="{{ $mainJSProcessed.Data.Integrity }}" defer></script>
	{{- end -}}

	{{- /* Custom JavaScript if defined */ -}}
	{{- if isset .Site.Params "customjs" -}}
		{{- range .Site.Params.customJS -}}
			{{- $customJS := resources.Get . -}}
			{{- if $customJS -}}
				{{- $customJSProcessed := $customJS | resources.Minify | resources.Fingerprint -}}
				<script src="{{ $customJSProcessed.RelPermalink }}" integrity="{{ $customJSProcessed.Data.Integrity }}" defer></script>
			{{- end -}}
		{{- end -}}
	{{- end -}}
</head>
