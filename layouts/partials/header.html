<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	{{- /* Inline critical theme-init script to avoid render blocking */ -}}
	{{- with resources.Get "js/theme-init.js" -}}
		{{- $themeInit := . | resources.Minify -}}
		<script>{{ $themeInit.Content | safeJS }}</script>
	{{- end -}}

	{{- partial "security-headers.html" . -}}
	{{- $title := .Title -}}
	{{- $siteTitle := .Site.Title -}}
	{{- if .IsHome -}}
	<title>{{ $siteTitle }}{{ with .Site.Params.subtitle }} - {{ . }}{{ end }}</title>
	{{- else -}}
	<title>{{ $title }} - {{ $siteTitle }}</title>
	{{- end -}}

	{{- if isset .Site.Params "favicon" -}}
		<link rel="icon" type="image/x-icon" href="/{{ .Site.Params.favicon }}">
		<link rel="shortcut icon" type="image/x-icon" href="/{{ .Site.Params.favicon }}">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="manifest" href="/site.webmanifest">
		<meta name="theme-color" content="#007acc">
		<meta name="msapplication-TileColor" content="#007acc">
		<meta name="msapplication-config" content="/browserconfig.xml">
	{{- else -}}
		<link rel="icon" type="image/x-icon" href="/favicon.ico">
		<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
	{{- end -}}

	<meta name="viewport" content="width=device-width, initial-scale=1">

	{{- /* Performance: Preload critical resources */ -}}
	{{- partial "resource-hints.html" . -}}

	{{- /* Performance: Resource hints for external domains */ -}}
	{{- if .Site.Params.featherIconsCDN -}}
	<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
	<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
	{{- end -}}

	{{- if .IsHome -}}
	<meta name="description" content="{{ .Site.Params.description }}">
	{{- else if .Description -}}
	<meta name="description" content="{{ .Description }}">
	{{- else if .Summary -}}
	<meta name="description" content="{{ .Summary | plainify | truncate 160 }}">
	{{- else -}}
	<meta name="description" content="{{ .Site.Params.description }}">
	{{- end -}}
	{{ with .OutputFormats.Get "rss" -}}
	{{ printf `
	<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
	{{ end -}}

	{{- partial "components/seo/canonical.html" . -}}
	{{- partial "components/seo/json_ld.html" . -}}
	{{- template "_internal/opengraph.html" . -}}
	{{- template "_internal/twitter_cards.html" . -}}

	{{- $cssResources := slice -}}
	{{- range (slice "css/normalize.css" "css/main.css" "css/github-markdown.css" "css/github-codeblocks.css" "css/social-share.css" "css/author-bio.css" "css/related-content-advanced.css" "css/breadcrumb.css" "css/accessibility.css") -}}
		{{- with resources.Get . -}}
			{{- $cssResources = $cssResources | append . -}}
		{{- end -}}
	{{- end -}}

	{{- if or (eq .Kind "taxonomy") (eq .Kind "term") -}}
		{{- with resources.Get "css/tags.css" -}}
			{{- $cssResources = $cssResources | append . -}}
		{{- end -}}
	{{- end -}}

	{{- $customCSS := .Site.Params.customCSS -}}
	{{- if $customCSS -}}
		{{- $customSlice := cond (reflect.IsSlice $customCSS) $customCSS (slice $customCSS) -}}
		{{- range $customSlice -}}
			{{- with resources.Get . -}}
				{{- $cssResources = $cssResources | append . -}}
			{{- end -}}
		{{- end -}}
	{{- end -}}

	{{- with resources.Get "css/dark.css" -}}
		{{- $cssResources = $cssResources | append . -}}
	{{- end -}}

	{{- if .Site.Params.enablePagefind -}}
		{{- with resources.Get "css/search.css" -}}
			{{- $cssResources = $cssResources | append . -}}
		{{- end -}}
	{{- end -}}

	{{- if eq .Layout "topic-hub" -}}
		{{- with resources.Get "css/topic-hub.css" -}}
			{{- $cssResources = $cssResources | append . -}}
		{{- end -}}
	{{- end -}}

	{{- if or (eq .Type "series") (eq .Type "topics") (eq .Kind "taxonomy") -}}
		{{- with resources.Get "css/series.css" -}}
			{{- $cssResources = $cssResources | append . -}}
		{{- end -}}
	{{- end -}}

	{{- if or (eq .Type "about") (in .RelPermalink "/about") -}}
		{{- with resources.Get "css/series.css" -}}
			{{- $cssResources = $cssResources | append . -}}
		{{- end -}}
		{{- with resources.Get "css/author-eeat.css" -}}
			{{- $cssResources = $cssResources | append . -}}
		{{- end -}}
	{{- end -}}

	{{- with resources.Get "css/aesthetic-refinements.css" -}}
		{{- $cssResources = $cssResources | append . -}}
	{{- end -}}

	{{- if gt (len $cssResources) 0 -}}
		{{- $bundle := $cssResources | resources.Concat "css/bundle.css" | resources.Minify | resources.Fingerprint -}}
		<style>
	body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;line-height:1.6;color:#212121;margin:0;padding:0}
	.container{max-width:900px;margin:0 auto;padding:0 1rem}
	.header{text-align:center;padding:2rem 0}
	.site-title{margin:0.5rem 0;font-size:2rem}
	.site-title a{color:#212121;text-decoration:none}
	@media (prefers-color-scheme:dark){body{color:#e0e0e0;background:#1a1a1a}.site-title a{color:#e0e0e0}}
	.dark{color:#e0e0e0;background:#1a1a1a}
	.dark .site-title a{color:#e0e0e0}
	</style>
		{{- /* Async CSS loading using preload with onload trick for better FCP */ -}}
		<link rel="preload" href="{{ $bundle.RelPermalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'" integrity="{{ $bundle.Data.Integrity }}">
		<noscript><link rel="stylesheet" href="{{ $bundle.RelPermalink }}" integrity="{{ $bundle.Data.Integrity }}"></noscript>
	{{- end -}}

	{{- $enableUmami := and (isset .Site.Params "enableUmami") (.Site.Params.enableUmami) -}}
	{{- $hasURL := isset .Site.Params "umamiURL" -}}
	{{- $hasID := isset .Site.Params "umamiWebsiteId" -}}
	{{- if and $enableUmami $hasURL $hasID -}}
	<script defer src="{{ .Site.Params.umamiURL }}" data-website-id="{{ .Site.Params.umamiWebsiteId }}" data-tag="blog"></script>
	{{- end -}}

	{{- /* Bundled init script (icons, share, codeblock) - reduces 3 requests to 1 */ -}}
	{{- with resources.Get "js/bundle-init.js" -}}
		{{- $bundle := . | resources.Minify | resources.Fingerprint -}}
		<script src="{{ $bundle.RelPermalink }}" integrity="{{ $bundle.Data.Integrity }}" defer></script>
	{{- end -}}

	{{- with resources.Get "js/main.js" -}}
		{{- $mainJS := . | resources.Minify | resources.Fingerprint -}}
		<script src="{{ $mainJS.RelPermalink }}" integrity="{{ $mainJS.Data.Integrity }}" defer></script>
	{{- end -}}

	{{- /* Performance: Lazy loading for below-the-fold content */ -}}
	{{- with resources.Get "js/lazy-content.js" -}}
		{{- $lazy := . | resources.Minify | resources.Fingerprint -}}
		<script src="{{ $lazy.RelPermalink }}" integrity="{{ $lazy.Data.Integrity }}" defer></script>
	{{- end -}}

	{{- /* Error tracking (dev only) */ -}}
	{{- with resources.Get "js/error-tracker.js" -}}
		{{- $errorTracker := . | resources.Minify | resources.Fingerprint -}}
		<script src="{{ $errorTracker.RelPermalink }}" integrity="{{ $errorTracker.Data.Integrity }}" defer></script>
	{{- end -}}

	{{- $customJS := .Site.Params.customJS -}}
	{{- if $customJS -}}
		{{- $jsSlice := cond (reflect.IsSlice $customJS) $customJS (slice $customJS) -}}
		{{- range $jsSlice -}}
			{{- with resources.Get . -}}
				{{- $script := . | resources.Minify | resources.Fingerprint -}}
				<script src="{{ $script.RelPermalink }}" integrity="{{ $script.Data.Integrity }}" defer></script>
			{{- end -}}
		{{- end -}}
	{{- end -}}
</head>
