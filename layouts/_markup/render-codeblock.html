{{- $lang := .Type | default "text" -}}
{{- $options := .Attributes -}}

{{- /* Produce highlight HTML */ -}}
{{- $html := highlight .Inner $lang (dict "style" "github" "lineNos" (index $options "lineNos") "hl_lines" (index $options "hl_lines") "lineNumbersInTable" true) -}}

{{- /* Inject language metadata on the wrapper for CSP-friendly enhancement */ -}}
{{- $withData := replaceRE `<div class="highlight"` (printf `<div class="highlight highlight-%s" data-lang="%s"` $lang $lang) $html -}}

{{- $withData | safeHTML -}}
